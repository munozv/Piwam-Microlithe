CREATE TABLE piwam_account (id INT AUTO_INCREMENT, label VARCHAR(255) NOT NULL, association_id INT NOT NULL, reference VARCHAR(64) NOT NULL, state TINYINT DEFAULT '1', created_by INT, updated_by INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX association_id_idx (association_id), INDEX created_by_idx (created_by), INDEX updated_by_idx (updated_by), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_acl_action (id INT AUTO_INCREMENT, acl_module_id INT, label VARCHAR(255) NOT NULL, code VARCHAR(100) NOT NULL, INDEX acl_module_id_idx (acl_module_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_acl_credential (id INT AUTO_INCREMENT, member_id INT, acl_action_id INT, INDEX acl_action_id_idx (acl_action_id), INDEX member_id_idx (member_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_acl_module (id INT AUTO_INCREMENT, label VARCHAR(255) NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_activity (id INT AUTO_INCREMENT, label VARCHAR(255) NOT NULL, state TINYINT DEFAULT '1', association_id INT NOT NULL, created_by INT, updated_by INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX association_id_idx (association_id), INDEX created_by_idx (created_by), INDEX updated_by_idx (updated_by), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_association (id INT AUTO_INCREMENT, name VARCHAR(120) NOT NULL, description VARCHAR(255), website VARCHAR(255), created_by INT, updated_by INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX created_by_idx (created_by), INDEX updated_by_idx (updated_by), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_config_category (code VARCHAR(25), label VARCHAR(255) NOT NULL, PRIMARY KEY(code)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_config_value (config_variable_id INT, association_id INT, custom_value VARCHAR(255) NOT NULL, PRIMARY KEY(config_variable_id, association_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_config_variable (id INT AUTO_INCREMENT, code VARCHAR(25) NOT NULL, category_code VARCHAR(25) NOT NULL, label VARCHAR(255) NOT NULL, description TEXT, type VARCHAR(255) NOT NULL, default_value VARCHAR(255) NOT NULL, INDEX category_code_idx (category_code), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_data (id INT AUTO_INCREMENT, config_key VARCHAR(255) NOT NULL, value VARCHAR(255) NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwampg_debt (id INT AUTO_INCREMENT, member_id INT NOT NULL, income_id INT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX member_id_idx (member_id), INDEX income_id_idx (income_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_due (id INT AUTO_INCREMENT, account_id INT NOT NULL, due_type_id INT NOT NULL, member_id INT NOT NULL, date DATE NOT NULL, amount DECIMAL(10,  2) NOT NULL, created_by INT, updated_by INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX account_id_idx (account_id), INDEX due_type_id_idx (due_type_id), INDEX member_id_idx (member_id), INDEX created_by_idx (created_by), INDEX updated_by_idx (updated_by), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_due_type (id INT AUTO_INCREMENT, label VARCHAR(255) NOT NULL, association_id INT NOT NULL, period INT NOT NULL, amount DECIMAL(10,  2) NOT NULL, state TINYINT DEFAULT '1', created_by INT, updated_by INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX association_id_idx (association_id), INDEX created_by_idx (created_by), INDEX updated_by_idx (updated_by), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_expense (id INT AUTO_INCREMENT, label VARCHAR(255) NOT NULL, amount DECIMAL(10,  2) NOT NULL, association_id INT NOT NULL, account_id INT NOT NULL, activity_id INT NOT NULL, date DATE NOT NULL, paid TINYINT(1) DEFAULT '1', created_by INT, updated_by INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX association_id_idx (association_id), INDEX account_id_idx (account_id), INDEX activity_id_idx (activity_id), INDEX created_by_idx (created_by), INDEX updated_by_idx (updated_by), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_income (id INT AUTO_INCREMENT, label VARCHAR(255) NOT NULL, association_id INT NOT NULL, amount DECIMAL(10,  2) NOT NULL, account_id INT NOT NULL, activity_id INT NOT NULL, date DATE NOT NULL, received TINYINT(1) DEFAULT '1', created_by INT, updated_by INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX association_id_idx (association_id), INDEX account_id_idx (account_id), INDEX activity_id_idx (activity_id), INDEX created_by_idx (created_by), INDEX updated_by_idx (updated_by), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_member (id INT AUTO_INCREMENT, lastname VARCHAR(255) NOT NULL, firstname VARCHAR(255) NOT NULL, username VARCHAR(255), password VARCHAR(255), status_id INT NOT NULL, subscription_date DATE NOT NULL, due_exempt TINYINT(1) NOT NULL, street VARCHAR(255), zipcode VARCHAR(8), city VARCHAR(255), country VARCHAR(8), picture VARCHAR(255), email VARCHAR(255), website VARCHAR(255), phone_home VARCHAR(16), phone_mobile VARCHAR(16), state TINYINT DEFAULT '1' NOT NULL, association_id INT NOT NULL, created_by INT, updated_by INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX association_id_idx (association_id), INDEX status_id_idx (status_id), INDEX created_by_idx (created_by), INDEX updated_by_idx (updated_by), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_member_extra_row (id INT AUTO_INCREMENT, association_id INT NOT NULL, label VARCHAR(255) NOT NULL, description TEXT, type VARCHAR(255) NOT NULL, default_value VARCHAR(255) NOT NULL, INDEX association_id_idx (association_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_member_extra_value (row_id INT, member_id INT, value VARCHAR(255) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(row_id, member_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE piwam_status (id INT AUTO_INCREMENT, label VARCHAR(255) NOT NULL, association_id INT NOT NULL, state TINYINT DEFAULT '1', created_by INT, updated_by INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX association_id_idx (association_id), INDEX created_by_idx (created_by), INDEX updated_by_idx (updated_by), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
ALTER TABLE piwam_account ADD CONSTRAINT piwam_account_updated_by_piwam_member_id FOREIGN KEY (updated_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_account ADD CONSTRAINT piwam_account_created_by_piwam_member_id FOREIGN KEY (created_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_account ADD CONSTRAINT piwam_account_association_id_piwam_association_id FOREIGN KEY (association_id) REFERENCES piwam_association(id) ON DELETE CASCADE;
ALTER TABLE piwam_acl_action ADD CONSTRAINT piwam_acl_action_acl_module_id_piwam_acl_module_id FOREIGN KEY (acl_module_id) REFERENCES piwam_acl_module(id) ON DELETE CASCADE;
ALTER TABLE piwam_acl_credential ADD CONSTRAINT piwam_acl_credential_member_id_piwam_member_id FOREIGN KEY (member_id) REFERENCES piwam_member(id) ON DELETE CASCADE;
ALTER TABLE piwam_acl_credential ADD CONSTRAINT piwam_acl_credential_acl_action_id_piwam_acl_action_id FOREIGN KEY (acl_action_id) REFERENCES piwam_acl_action(id) ON DELETE CASCADE;
ALTER TABLE piwam_activity ADD CONSTRAINT piwam_activity_updated_by_piwam_member_id FOREIGN KEY (updated_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_activity ADD CONSTRAINT piwam_activity_created_by_piwam_member_id FOREIGN KEY (created_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_activity ADD CONSTRAINT piwam_activity_association_id_piwam_association_id FOREIGN KEY (association_id) REFERENCES piwam_association(id) ON DELETE CASCADE;
ALTER TABLE piwam_association ADD CONSTRAINT piwam_association_updated_by_piwam_member_id FOREIGN KEY (updated_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_association ADD CONSTRAINT piwam_association_created_by_piwam_member_id FOREIGN KEY (created_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_config_value ADD CONSTRAINT piwam_config_value_config_variable_id_piwam_config_variable_id FOREIGN KEY (config_variable_id) REFERENCES piwam_config_variable(id) ON DELETE CASCADE;
ALTER TABLE piwam_config_value ADD CONSTRAINT piwam_config_value_association_id_piwam_association_id FOREIGN KEY (association_id) REFERENCES piwam_association(id) ON DELETE CASCADE;
ALTER TABLE piwam_config_variable ADD CONSTRAINT piwam_config_variable_category_code_piwam_config_category_code FOREIGN KEY (category_code) REFERENCES piwam_config_category(code) ON DELETE CASCADE;
ALTER TABLE piwampg_debt ADD CONSTRAINT piwampg_debt_member_id_piwam_member_id FOREIGN KEY (member_id) REFERENCES piwam_member(id) ON DELETE CASCADE;
ALTER TABLE piwampg_debt ADD CONSTRAINT piwampg_debt_income_id_piwam_income_id FOREIGN KEY (income_id) REFERENCES piwam_income(id) ON DELETE CASCADE;
ALTER TABLE piwam_due ADD CONSTRAINT piwam_due_updated_by_piwam_member_id FOREIGN KEY (updated_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_due ADD CONSTRAINT piwam_due_member_id_piwam_member_id FOREIGN KEY (member_id) REFERENCES piwam_member(id) ON DELETE CASCADE;
ALTER TABLE piwam_due ADD CONSTRAINT piwam_due_due_type_id_piwam_due_type_id FOREIGN KEY (due_type_id) REFERENCES piwam_due_type(id) ON DELETE CASCADE;
ALTER TABLE piwam_due ADD CONSTRAINT piwam_due_created_by_piwam_member_id FOREIGN KEY (created_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_due ADD CONSTRAINT piwam_due_account_id_piwam_account_id FOREIGN KEY (account_id) REFERENCES piwam_account(id) ON DELETE CASCADE;
ALTER TABLE piwam_due_type ADD CONSTRAINT piwam_due_type_updated_by_piwam_member_id FOREIGN KEY (updated_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_due_type ADD CONSTRAINT piwam_due_type_created_by_piwam_member_id FOREIGN KEY (created_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_due_type ADD CONSTRAINT piwam_due_type_association_id_piwam_association_id FOREIGN KEY (association_id) REFERENCES piwam_association(id) ON DELETE CASCADE;
ALTER TABLE piwam_expense ADD CONSTRAINT piwam_expense_updated_by_piwam_member_id FOREIGN KEY (updated_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_expense ADD CONSTRAINT piwam_expense_created_by_piwam_member_id FOREIGN KEY (created_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_expense ADD CONSTRAINT piwam_expense_association_id_piwam_association_id FOREIGN KEY (association_id) REFERENCES piwam_association(id) ON DELETE CASCADE;
ALTER TABLE piwam_expense ADD CONSTRAINT piwam_expense_activity_id_piwam_activity_id FOREIGN KEY (activity_id) REFERENCES piwam_activity(id) ON DELETE CASCADE;
ALTER TABLE piwam_expense ADD CONSTRAINT piwam_expense_account_id_piwam_account_id FOREIGN KEY (account_id) REFERENCES piwam_account(id) ON DELETE CASCADE;
ALTER TABLE piwam_income ADD CONSTRAINT piwam_income_updated_by_piwam_member_id FOREIGN KEY (updated_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_income ADD CONSTRAINT piwam_income_created_by_piwam_member_id FOREIGN KEY (created_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_income ADD CONSTRAINT piwam_income_association_id_piwam_association_id FOREIGN KEY (association_id) REFERENCES piwam_association(id) ON DELETE CASCADE;
ALTER TABLE piwam_income ADD CONSTRAINT piwam_income_activity_id_piwam_activity_id FOREIGN KEY (activity_id) REFERENCES piwam_activity(id) ON DELETE CASCADE;
ALTER TABLE piwam_income ADD CONSTRAINT piwam_income_account_id_piwam_account_id FOREIGN KEY (account_id) REFERENCES piwam_account(id) ON DELETE CASCADE;
ALTER TABLE piwam_member ADD CONSTRAINT piwam_member_updated_by_piwam_member_id FOREIGN KEY (updated_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_member ADD CONSTRAINT piwam_member_status_id_piwam_status_id FOREIGN KEY (status_id) REFERENCES piwam_status(id) ON DELETE CASCADE;
ALTER TABLE piwam_member ADD CONSTRAINT piwam_member_created_by_piwam_member_id FOREIGN KEY (created_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_member ADD CONSTRAINT piwam_member_association_id_piwam_association_id FOREIGN KEY (association_id) REFERENCES piwam_association(id) ON DELETE CASCADE;
ALTER TABLE piwam_member_extra_row ADD CONSTRAINT piwam_member_extra_row_association_id_piwam_association_id FOREIGN KEY (association_id) REFERENCES piwam_association(id) ON DELETE CASCADE;
ALTER TABLE piwam_member_extra_value ADD CONSTRAINT piwam_member_extra_value_row_id_piwam_member_extra_row_id FOREIGN KEY (row_id) REFERENCES piwam_member_extra_row(id) ON DELETE CASCADE;
ALTER TABLE piwam_member_extra_value ADD CONSTRAINT piwam_member_extra_value_member_id_piwam_member_id FOREIGN KEY (member_id) REFERENCES piwam_member(id) ON DELETE CASCADE;
ALTER TABLE piwam_status ADD CONSTRAINT piwam_status_updated_by_piwam_member_id FOREIGN KEY (updated_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_status ADD CONSTRAINT piwam_status_created_by_piwam_member_id FOREIGN KEY (created_by) REFERENCES piwam_member(id) ON DELETE SET NULL;
ALTER TABLE piwam_status ADD CONSTRAINT piwam_status_association_id_piwam_association_id FOREIGN KEY (association_id) REFERENCES piwam_association(id) ON DELETE CASCADE;
